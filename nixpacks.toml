# Nixpacks configuration for Railway
# Uses nightly Rust to support edition2024

[phases.setup]
nixPkgs = ["gcc", "pkg-config", "openssl"]

[phases.install]
cmds = [
    "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain nightly",
    ". $HOME/.cargo/env && rustup default nightly",
    ". $HOME/.cargo/env && cargo fetch"
]

[phases.build]
cmds = [". $HOME/.cargo/env && cargo build --release"]

[start]
cmd = "./target/release/divine-agi server --port ${PORT:-8080}"

